<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
    body,
    html,
    #allmap {
        width: 100%;
        height: 100%;
        overflow: auto;
        margin: 0;
        font-family: "微软雅黑";
        background: #eee;
    }

    #allmap {
        width: 100%;
        height: 100vh;
    }
    .xc-group {
      margin-bottom: 10px;
      background: #fff;
    }
    .xc-group > div > div {
      padding: 2px;
    }
    /*.sun-left .sun .sun-left > div:first-child {
      border-bottom: solid 1px #eee;
    }*/
    .sun{
      display: inline-block;vertical-align: top;width:calc(100% - 70px);
    }
    .xc-group .sun:first-child {
      border-bottom: solid 1px #eee;
    }
    .sub-right {
      display: inline-block;vertical-align: top;width:60px;
      text-align: center;
      position: relative;top:-10px;
    }
    </style>
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?type=webgl&v=1.0&ak=48Roq20p72HfZGhxnKm3BPE8mK4ZCtzc"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/LuShu/gl/src/LuShu_min.js"></script>
    <!-- <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script> -->
    <link href="./lib/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css" />
    <script src="./lib/jquery/jquery-1.3.2.min.js" type="text/javascript"></script>
    <script src="./lib/ligerUI/js/core/base.js" type="text/javascript"></script>
    <script src="./lib/ligerUI/js/ligerui.all.js" type="text/javascript"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <title>车辆行程</title>
</head>

<body>
    <div id="allmap">
      <div>
        <div v-for="(item,index) in rows" style="padding: 8px" :key="index">
          <div v-for="(sub,sindex) in item" :key="sindex" class="xc-group">
            <div v-for="(sun,sunindex) in sub" class="sun" :key="sunindex">
              <div>
                <span>{{sun.gpsTime}}</span>
                <label>{{sunindex == 0?'起点':'终点'}}</label>
              </div>
              <div>{{sun.locationName}}</div>
            </div>
            <div class="sub-right" style="">
                123公里
              </div>
          </div>
        </div>
      </div>
    </div>
</body>

</html>
<script type="text/javascript">
  var now = getNowFormatDate();
  var imei = window.location.href.split('imei=')[1];
  var app = new Vue({
    el: '#allmap',
    data: {
      message: '行程数据',
      rows:[],
      locationNames:[]
    },
    created(){
      this.main();
    },
    methods:{
      main(){
        var that = this;
        $.ajax({ 
          url: "http://www.huatiexft.com:8070/eqplapp2/login.do", 
          type:'post',
          dataType:'json',
          contentType:'application/json',
          data:JSON.stringify({"user_code":"陈李强辉","password":123456,"loginType":"20"}),
          xhrFields: {
            withCredentials: true //允许跨域带Cookie
          },
          success: function(data){
            // ?__user_session=738CB5F330B7F0A538A22F8CD30977A6
            sessionStorage.setItem('__user_session',data.success)
            sessionStorage.setItem('_userInfo',JSON.stringify(data))
            let param = {
              startTime:now + ' 00:00:00',
              endTime:now + ' 23:59:59',
              imei:imei
            };
            that.initXC(param)
            // initPosition()
          }
        });
      },
      initXC(param){
        var that = this;
        $.ajax({  
          url:"http://www.huatiexft.com:8070/eqplapp2/jimiCar/getTravel.do?imei="+param.imei+"&startTime="+param.startTime+"&endTime="+param.endTime+"&__user_session="+sessionStorage.getItem('__user_session'),
          type:'get',
          contentType:'application/json',
          data:{},
          xhrFields: {
            withCredentials: true
          },
          success: function(data){
            if(data){
              try {
                let tmpdata = JSON.parse(data);
                console.log('tmpdata',tmpdata)
                tmpdata.data.forEach(item => {
                  item.forEach(sub=>{
                    that.getLocationName(sub)
                  })
                });
                setTimeout(()=>{
                  that.rows = tmpdata
                },300)
                
                // initXCrows(tmpdata)
              } catch (err){
                console.log('error',err)
                $.ligerDialog.error('暂无数据')
              }
            }else {
              $.ligerDialog.error('暂无数据')
            }
          }
        });
      },
      initXCrows(row){

      },
      getLocationName(param){
        var that = this;
        var geoc = new BMapGL.Geocoder();
        let pt = new BMapGL.Point(param.lng,param.lat)
        // let pt = {
        //   lng:param.lng,
        //   lat:param.lat
        // };
        geoc.getLocation(pt, function(rs){
          var addComp = rs.addressComponents;
          param.locationName = addComp.province  + addComp.city  + addComp.district  + addComp.street  + addComp.streetNumber;
          that.locationNames.push(addComp.province  + addComp.city  + addComp.district  + addComp.street  + addComp.streetNumber);
        })
      }
    }
  })
 
function getNowFormatDate() {
  var date = new Date();
  var seperator1 = "-";
  var year = date.getFullYear();
  var month = date.getMonth() + 1;
  var strDate = date.getDate();
  if (month >= 1 && month <= 9) {
      month = "0" + month;
  }
  if (strDate >= 0 && strDate <= 9) {
      strDate = "0" + strDate;
  }
  var currentdate = year + seperator1 + month + seperator1 + strDate;
  return currentdate;
}
</script>